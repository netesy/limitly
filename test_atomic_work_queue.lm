// Test atomic operations and work queue functionality

var test_atomic = 0;
print("Initial atomic value: " + test_atomic);

// Test setting atomic value
test_atomic = 42;
print("Atomic value after assignment: " + test_atomic);

// Test atomic operations through concurrent blocks
var work_channel = channel();

concurrent(mode=batch) {
    task() {
        // Simulate atomic increment
        test_atomic += 1;
        work_channel.send(test_atomic);
    }
    task() {
        // Simulate atomic increment
        test_atomic += 1;
        work_channel.send(test_atomic);
    }
}

// Read results using iteration
iter (result in work_channel) {
    print("Task result: " + result);
}

print("Final atomic value: " + test_atomic);

print("Atomic operations test completed!");
