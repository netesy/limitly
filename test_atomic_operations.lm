// Test atomic operations and work queue functionality

func main() {
    print("Testing atomic operations...")
    
    // Test atomic store
    atomic_store(42)
    var value = atomic_load()
    print("Atomic value after store: " + value)
    
    // Test atomic fetch and add
    var old_value = atomic_fetch_add(10)
    print("Old value from fetch_add: " + old_value)
    
    var new_value = atomic_load()
    print("New value after fetch_add: " + new_value)
    
    // Test work queue operations
    print("Testing work queue...")
    
    var queue_id = work_queue_alloc(100)
    print("Allocated queue ID: " + queue_id)
    
    // Push some tasks
    work_queue_push(queue_id, 1)
    work_queue_push(queue_id, 2)
    work_queue_push(queue_id, 3)
    
    // Pop tasks
    var task1 = work_queue_pop(queue_id)
    var task2 = work_queue_pop(queue_id)
    var task3 = work_queue_pop(queue_id)
    
    print("Popped tasks: " + task1 + ", " + task2 + ", " + task3)
    
    // Test worker signal with work processing
    print("Testing worker signal...")
    
    // Set atomic to non-zero value
    atomic_store(5)
    print("Atomic before worker signal: " + atomic_load())
    
    // Signal worker (should process work and set atomic to 0)
    worker_signal(1, 1)
    print("Atomic after worker signal: " + atomic_load())
    
    print("All tests completed!")
}
