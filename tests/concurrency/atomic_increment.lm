var counter: int = 0;
var ch = channel();

assert(counter == 0, "Initial int counter should be 0");

concurrent(ch=ch) {
    task(i in 1..10) {
        counter += 1;
        ch.send(counter);
    }
}

// Drain channel
var seen = 0;
print("Value from channel: {ch}");
iter (v in ch) {
    print("Value from channel loop: {v}");
    seen += 1;
    if (seen >= 10) break;
}

assert(seen == 10, "Should receive 10 values from channel");
assert(counter == 10, "Final counter should be 10");
print("Final counter: {counter}");
