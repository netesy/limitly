// Concurrency smoke test - exercises atomics and simple tasks without channels
print("=== Concurrency Smoke Test ===");

// Atomic counter
var counter: int = 0;
assert(counter == 0, "Initial counter should be 0");

print("Tasks Iteration Tests");

// Fixed iteration block - using the correct syntax that should work
concurrent(mode=batch, cores=2, on_error=Stop) {
    task(i in 1..4) {
        counter += 1;
        print("Task running with counter {counter}");
    }
}

assert(counter == 4, "Counter should be 4 after running 4 tasks");
print("end Task tests");
print("Final counter value: {counter}");
print("Smoke test finished");

// Test the exact syntax from the working example
print("=== Test Concurrent Iteration ===");

// concurrent {
//     task(i in 1..2) {
//         print("Task {i} with default parameters");
//     }
// }

print("Test finished");


