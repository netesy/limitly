print("=== Basic Closures Tests ===");

print("\n--- Test 1: Simple Closure ---");
fn createGreeter(greeting: str): fn(str): str {
    return fn(name: str): str {
        return greeting + ", " + name + "!";
    };
}

var sayHello = createGreeter("Hello");
var greeting1 = sayHello("World");
print("sayHello('World') = " + greeting1);

var sayGoodbye = createGreeter("Goodbye");
var greeting2 = sayGoodbye("Friend");
print("sayGoodbye('Friend') = " + greeting2);

print("\n--- Test 2: Counter Closure ---");
fn createCounter(): fn(): int {
    var count: int = 0;
    return fn(): int {
        count = count + 1;
        return count;
    };
}

var counter1 = createCounter();
print("counter1() = " + counter1());
print("counter1() = " + counter1());
print("counter1() = " + counter1());

var counter2 = createCounter();
print("counter2() = " + counter2());
print("counter2() = " + counter2());

print("\n--- Test 3: Closure with Multiple Variables ---");
fn createCalculator(initial: int): (fn(int): int, fn(int): int, fn(): int) {
    var value: int = initial;
    
    var adder = fn(x: int): int {
        value = value + x;
        return value;
    };
    
    var multiplier = fn(x: int): int {
        value = value * x;
        return value;
    };
    
    var getter = fn(): int {
        return value;
    };
    
    return (adder, multiplier, getter);
}

var (add, mult, get) = createCalculator(10);
print("Initial value: " + get());
print("After add(5): " + add(5));
print("After mult(2): " + mult(2));
print("Final value: " + get());

print("\n--- Test 4: Nested Closures ---");
fn createNestedCounter(step: int): fn(): fn(): int {
    var outerCount: int = 0;
    return fn(): fn(): int {
        outerCount = outerCount + step;
        var innerCount: int = outerCount;
        return fn(): int {
            innerCount = innerCount + 1;
            return innerCount;
        };
    };
}

var nestedCounterFactory = createNestedCounter(10);
var innerCounter1 = nestedCounterFactory();
var innerCounter2 = nestedCounterFactory();

print("innerCounter1(): " + innerCounter1());
print("innerCounter1(): " + innerCounter1());
print("innerCounter2(): " + innerCounter2());
print("innerCounter2(): " + innerCounter2());

print("\n=== Basic Closures Tests Complete ===");